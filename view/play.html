<!DOCTYPE html>
<html>
<head>
	<title>play</title>
	<meta charset="utf-8">
</head>
<style type="text/css">
	#cav{background-color: #000}
</style>
<body>
	<h1>play</h1>
	<canvas id="cav" width="1000" height="600">
		
	</canvas>
</body>
</html>
<script src="/assets/canvas.js"></script>
<script type="text/javascript">
	let room = []
	let ws = new WebSocket("ws://127.0.0.1:8020")
	let ctx = new canvas('cav',5)
	ctx.cell()
	ws.onopen = function(evt) { 
		console.log('ws开启')
		command()
		ws.onmessage = function(event) {
			if(event) {
				room = JSON.parse(event.data)
				ctx.move(room)
			}		
		}
	}
	ws.onclose = function(evt) {
		console.log('ws关闭')
	} 
	
	// 键盘事件
	function command(){
		const keyCodes = {
			39: 'right',
			37: 'left',
			40: 'down',
			38: 'up' 
		}
		document.onkeydown = function(e) {
			let keyCode = e.which
			let keyString = keyCodes[keyCode]
			if(!keyString) {
				return false
			}
			let data = {type: 'command', event: keyString}
			console.log(data)
			ws.send(JSON.stringify(data))
		}
	}
	


</script>